<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RS ART | Sistema de Alarma Real</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --purple: #2D1B4E; --lime: #C6FF00; --magenta: #E91E63; --dark: #0F091A; }
        body { background: var(--dark); color: white; font-family: 'Inter', sans-serif; overflow-x: hidden; }

        /* Efecto de Luces de Polic칤a cuando suena la alarma */
        .alarm-active { animation: police-lights 0.2s infinite; }
        @keyframes police-lights {
            0% { background: #ff0000; }
            50% { background: #0000ff; }
            100% { background: #ff0000; }
        }

        .timbre-btn {
            position: fixed; bottom: 25px; right: 25px;
            width: 80px; height: 80px; background: var(--magenta);
            border-radius: 50%; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 9999;
            cursor: pointer; box-shadow: 0 0 30px var(--magenta);
            animation: pulse-ring 2s infinite; border: 3px solid white;
        }

        @keyframes pulse-ring {
            0% { transform: scale(1); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 20px rgba(233, 30, 99, 0); }
            100% { transform: scale(1); }
        }

        #adminPanel, #monitorStatus { display: none; }
    </style>
</head>
<body id="mainBody">

    <!-- SONIDO DE SIRENA (Link ultra confiable) -->
    <audio id="audioAlarma" preload="auto" loop>
        <source src="https://www.soundjay.com/buttons/sounds/alarm-clock-01.mp3" type="audio/mpeg">
    </audio>

    <header class="p-4 border-b border-white/10 sticky top-0 z-[1000] bg-[#0F091A]/90 backdrop-blur-xl">
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-3xl font-black italic tracking-tighter">RS <span class="text-[var(--lime)]">ART</span></div>
            <button onclick="loginAdmin()" class="text-[var(--magenta)] font-bold text-xs uppercase border border-[var(--magenta)] px-4 py-2 rounded-full">Admin</button>
        </div>
    </header>

    <!-- ESTADO DEL MONITOR -->
    <div id="monitorStatus" class="bg-green-600 text-white p-3 text-center font-bold">
        <i class="fas fa-satellite-dish animate-bounce mr-2"></i> MONITOR ACTIVO: Esta PC sonar치 fuerte.
        <button onclick="detenerAlarma()" id="btnCerrarAlarma" class="hidden bg-white text-red-600 px-4 py-1 rounded ml-4">APAGAR SONIDO</button>
    </div>

    <!-- Contenido Simple para pruebas -->
    <main class="container mx-auto px-6 py-20 text-center">
        <h1 class="text-5xl font-black mb-6">BIENVENIDO A <span class="text-[var(--lime)]">RS ART</span></h1>
        <p class="text-gray-400 max-w-lg mx-auto">Si necesitas atenci칩n, toca el timbre de la derecha. El administrador recibir치 una alerta sonora inmediata.</p>
    </main>

    <!-- Panel Admin -->
    <section id="adminPanel" class="container mx-auto p-10 bg-white/5 rounded-3xl border border-dashed border-white/20 m-6">
        <h2 class="text-2xl font-bold text-[var(--lime)] mb-4">PANEL DE CONTROL</h2>
        <p>El sistema de escucha est치 listo. No cierres esta pesta침a.</p>
    </section>

    <!-- BOT칍N TIMBRE (PARA EL CLIENTE) -->
    <div class="timbre-btn" onclick="clienteTocaTimbre()">
        <i class="fas fa-bell text-3xl"></i>
        <span class="text-[10px] font-bold mt-1">TIMBRE</span>
    </div>

    <script>
        // 1. CONFIGURACI칍N FIREBASE
        const firebaseConfig = {
            databaseURL: "https://rs-art-timbre-default-rtdb.firebaseio.com/" // CAMBIA ESTO POR TU URL
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. L칍GICA DEL CLIENTE (CELULAR)
        function clienteTocaTimbre() {
            // Enviamos un ID 칰nico por cada toque para que la PC siempre detecte un "cambio"
            db.ref('sistema_alarma').set({
                activo: true,
                timestamp: Date.now(),
                msg: "游댒 춰ALGUIEN TOCA EL TIMBRE!"
            }).then(() => {
                Swal.fire('Timbre Enviado', 'El administrador est치 siendo notificado.', 'success');
            });
        }

        // 3. L칍GICA DEL ADMINISTRADOR (PC)
        function iniciarEscuchaAdmin() {
            const audio = document.getElementById('audioAlarma');
            const body = document.getElementById('mainBody');
            const statusLabel = document.getElementById('monitorStatus');
            const btnCerrar = document.getElementById('btnCerrarAlarma');

            console.log("PC esperando se침al...");

            // Escuchamos Firebase
            db.ref('sistema_alarma').on('value', (snapshot) => {
                const data = snapshot.val();
                
                if (data && data.activo === true) {
                    console.log("춰Se침al de alarma recibida!");
                    
                    // Acci칩n: SONIDO Y LUCES
                    audio.play().catch(e => {
                        console.log("Error al reproducir: El usuario debe interactuar primero.");
                    });
                    body.classList.add('alarm-active');
                    btnCerrar.classList.remove('hidden');

                    Swal.fire({
                        title: data.msg,
                        text: 'Atenci칩n requerida inmediatamente',
                        icon: 'warning',
                        confirmButtonText: 'DETENER ALARMA',
                        confirmButtonColor: '#d33',
                        allowOutsideClick: false
                    }).then(() => {
                        detenerAlarma();
                    });
                }
            });
        }

        function detenerAlarma() {
            const audio = document.getElementById('audioAlarma');
            audio.pause();
            audio.currentTime = 0;
            document.getElementById('mainBody').classList.remove('alarm-active');
            document.getElementById('btnCerrarAlarma').classList.add('hidden');
            
            // Apagamos la se침al en Firebase para que no se repita infinitamente
            db.ref('sistema_alarma').update({ activo: false });
        }

        function loginAdmin() {
            Swal.fire({
                title: 'Acceso Admin',
                input: 'password',
                confirmButtonText: 'ENTRAR'
            }).then(res => {
                if (res.value === "2025") {
                    document.getElementById('adminPanel').style.display = 'block';
                    document.getElementById('monitorStatus').style.display = 'block';
                    
                    // PASO CRUCIAL: El navegador bloquea el sonido si el admin no hace "click" primero.
                    Swal.fire({
                        title: 'MODO MONITOR',
                        text: 'Haz clic en el bot칩n para activar los altavoces de esta PC.',
                        icon: 'info',
                        confirmButtonText: 'ACTIVAR ALTAVOCES'
                    }).then(() => {
                        // Reproducimos y pausamos r치pido para "enga침ar" al navegador y que nos d칠 permiso
                        const audio = document.getElementById('audioAlarma');
                        audio.play().then(() => {
                            audio.pause();
                            audio.currentTime = 0;
                            iniciarEscuchaAdmin(); // Ahora s칤 empezamos a escuchar Firebase
                        });
                    });
                }
            });
        }
    </script>
</body>
</html>
