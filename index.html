<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RS ART | Premium Studio</title>
    
    <!-- Librer√≠as -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root { --purple: #2D1B4E; --lime: #C6FF00; --magenta: #E91E63; --dark: #0F091A; }
        body { background: var(--dark); color: white; font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .swiper { width: 100%; padding: 50px 0; }
        .swiper-slide { width: 300px; height: 400px; border-radius: 30px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .swiper-slide img, .swiper-slide video { width: 100%; height: 100%; object-fit: cover; }
        .timbre-btn { position: fixed; bottom: 25px; right: 25px; width: 75px; height: 75px; background: var(--magenta); border-radius: 22px; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; cursor: pointer; box-shadow: 0 0 30px var(--magenta); animation: pulse-ring 2s infinite; border: 2px solid white; }
        @keyframes pulse-ring { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(233, 30, 99, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(233, 30, 99, 0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(233, 30, 99, 0); } }
        .card-pro { background: rgba(255,255,255,0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 30px; transition: 0.4s; }
        .card-pro:hover { transform: translateY(-10px) rotateX(5deg); border-color: var(--lime); }
        #adminPanel, #monitorPanel { display: none; background: #1a1425; border: 2px dashed var(--lime); margin-bottom: 20px; }
        header { position: sticky; top: 0; z-index: 1000; background: rgba(15, 9, 26, 0.9); backdrop-filter: blur(15px); }
        .alarm-active { animation: bg-flash 0.5s infinite; }
        @keyframes bg-flash { 0% { background: #1a1425; } 50% { background: #b91c1c; } 100% { background: #1a1425; } }
    </style>
</head>
<body>

    <header class="p-4 border-b border-white/10">
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-3xl font-black italic tracking-tighter">RS <span class="text-[var(--lime)]">ART</span></div>
            <nav class="hidden md:flex gap-8 font-bold text-xs uppercase tracking-widest">
                <a href="#" class="hover:text-[var(--lime)]">Inicio</a>
                <a href="javascript:void(0)" onclick="loginAdmin()" class="text-[var(--magenta)]">Admin/Monitor</a>
            </nav>
            <button onclick="abrirCarrito()" class="relative bg-white/10 p-3 rounded-full">
                <i class="fas fa-shopping-cart"></i>
                <span id="cart-count" class="absolute -top-1 -right-1 bg-[var(--lime)] text-black text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center">0</span>
            </button>
        </div>
    </header>

    <!-- PANEL DE MONITOREO (Solo para el due√±o) -->
    <section id="monitorPanel" class="container mx-auto p-8 rounded-3xl mt-4">
        <h2 class="text-2xl font-bold mb-4 text-[var(--lime)]">SISTEMA DE ALARMA ACTIVO</h2>
        <div class="flex flex-wrap gap-4 items-center">
            <div id="statusDot" class="w-4 h-4 bg-green-500 rounded-full animate-pulse"></div>
            <p>Escuchando peticiones en tiempo real...</p>
            <button onclick="detenerAlarma()" id="btnDetener" class="hidden bg-red-600 px-6 py-2 rounded-full font-bold">DETENER ALARMA</button>
        </div>
        <audio id="sonidoAlarma" loop src="https://assets.mixkit.co/active_storage/sfx/951/951-preview.mp3"></audio>
    </section>

    <!-- Panel de Administrador -->
    <section id="adminPanel" class="container mx-auto m-6 p-8 rounded-3xl">
        <h2 class="text-2xl font-bold mb-6 text-[var(--lime)] italic">GESTI√ìN DE INVENTARIO</h2>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <input type="text" id="adm-nombre" placeholder="Nombre del producto" class="bg-black/50 p-4 rounded-xl outline-none border border-white/10">
            <input type="number" id="adm-precio" placeholder="Precio ($)" class="bg-black/50 p-4 rounded-xl outline-none border border-white/10">
            <input type="text" id="adm-img" placeholder="URL de imagen" class="bg-black/50 p-4 rounded-xl outline-none border border-white/10">
            <textarea id="adm-desc" placeholder="Descripci√≥n corta" class="bg-black/50 p-4 rounded-xl outline-none border border-white/10"></textarea>
        </div>
        <button onclick="agregarNuevoProducto()" class="mt-6 bg-[var(--lime)] text-black font-black px-10 py-4 rounded-full hover:scale-105 transition">PUBLICAR PRODUCTO</button>
    </section>

    <!-- Slider 3D -->
    <section class="py-10">
        <div class="swiper mySwiper">
            <div class="swiper-wrapper">
                <div class="swiper-slide"><video src="https://assets.mixkit.co/videos/preview/mixkit-mechanical-parts-of-a-printing-press-working-43534-large.mp4" autoplay muted loop></video></div>
                <div class="swiper-slide"><img src="https://images.unsplash.com/photo-1626785774573-4b799315345d?w=600"></div>
                <div class="swiper-slide"><img src="https://images.unsplash.com/photo-1589118949245-7d38baf380d6?w=600"></div>
            </div>
        </div>
    </section>

    <!-- Secci√≥n de Productos -->
    <main class="container mx-auto px-6 py-10">
        <h2 id="productos" class="text-4xl font-black mb-12 italic tracking-tighter text-center md:text-left">CAT√ÅLOGO <span class="text-[var(--magenta)]">RS ART</span></h2>
        <div id="grid-productos" class="grid grid-cols-1 md:grid-cols-3 gap-10"></div>
    </main>

    <!-- BOT√ìN TIMBRE GLOBAL -->
    <div class="timbre-btn" onclick="activarTimbre()">
        <i class="fas fa-bell text-2xl"></i>
        <span class="text-[9px] font-bold mt-1">TIMBRE</span>
    </div>

    <script>
        // 1. CONFIGURACI√ìN FIREBASE (Crea uno en firebase.google.com)
        // Reemplaza esto con tus credenciales
        const firebaseConfig = {
            databaseURL: "https://rs-art-timbre-default-rtdb.firebaseio.com/" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const MI_NUMERO = "584125966071";
        const CLAVE_ADMIN = "2025";

        // Inicializar Swiper
        new Swiper(".mySwiper", {
            effect: "coverflow", grabCursor: true, centeredSlides: true, slidesPerView: "auto", loop: true,
            autoplay: { delay: 3000 }, coverflowEffect: { rotate: 50, stretch: 0, depth: 100, modifier: 1, slideShadows: true },
        });

        // Cargar productos
        let productos = JSON.parse(localStorage.getItem('rs_art_data')) || [
            { id: 1, nombre: "Folders Corporativos", precio: 45, img: "https://images.unsplash.com/photo-1626785774573-4b799315345d?w=600", desc: "Acabado mate y dise√±o personalizado." }
        ];
        let carrito = [];

        function render() {
            const grid = document.getElementById('grid-productos');
            grid.innerHTML = '';
            productos.forEach((p, index) => {
                grid.innerHTML += `
                    <div class="card-pro overflow-hidden">
                        <img src="${p.img}" class="w-full h-64 object-cover">
                        <div class="p-6">
                            <h3 class="text-xl font-bold">${p.nombre}</h3>
                            <p class="text-gray-400 text-sm my-3">${p.desc}</p>
                            <div class="flex justify-between items-center">
                                <span class="text-2xl font-black text-[var(--lime)]">$${p.precio}</span>
                                <button onclick="alCarrito(${index})" class="bg-[var(--magenta)] p-3 rounded-xl"><i class="fas fa-cart-plus"></i></button>
                            </div>
                        </div>
                    </div>`;
            });
        }

        function alCarrito(i) {
            carrito.push(productos[i]);
            document.getElementById('cart-count').innerText = carrito.length;
        }

        // --- L√ìGICA DE ALARMA ---

        // Funci√≥n para que el cliente dispare la alarma
        function dispararAlarmaRemota(tipo) {
            db.ref('alarma').set({
                activo: true,
                tipo: tipo,
                timestamp: Date.now()
            });
        }

        function activarTimbre() {
            dispararAlarmaRemota("¬°ALGUIEN TOCA EL TIMBRE!");
            Swal.fire('Timbre activado', 'El encargado ha sido notificado', 'success');
            // Opcional: Abrir WhatsApp tambi√©n
            // window.open(`https://wa.me/${MI_NUMERO}?text=üîî Timbreee!`);
        }

        function abrirCarrito() {
            if(carrito.length === 0) return Swal.fire('Carrito vac√≠o', '', 'info');
            let total = carrito.reduce((s, p) => s + p.precio, 0);
            
            Swal.fire({
                title: 'Confirmar Pedido',
                text: `Total: $${total}. Se activar√° la alarma del local.`,
                showCancelButton: true,
                confirmButtonText: 'Comprar y Notificar'
            }).then(res => {
                if(res.isConfirmed) {
                    dispararAlarmaRemota("¬°NUEVA COMPRA REALIZADA!");
                    window.open(`https://wa.me/${MI_NUMERO}?text=Nueva Compra de $${total}`);
                    carrito = [];
                    document.getElementById('cart-count').innerText = '0';
                }
            });
        }

        // --- L√ìGICA DE MONITOR (DUE√ëO) ---

        function loginAdmin() {
            Swal.fire({
                title: 'Acceso Privado',
                input: 'password',
                background: '#0F091A', color: '#fff'
            }).then(res => {
                if(res.value === CLAVE_ADMIN) {
                    document.getElementById('adminPanel').style.display = 'block';
                    document.getElementById('monitorPanel').style.display = 'block';
                    iniciarEscuchaAlarma();
                    Swal.fire('Modo Monitor Activo', 'Deja esta pesta√±a abierta para recibir alarmas', 'success');
                }
            });
        }

        function iniciarEscuchaAlarma() {
            const audio = document.getElementById('sonidoAlarma');
            const panel = document.getElementById('monitorPanel');
            const btnD = document.getElementById('btnDetener');

            db.ref('alarma').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data && data.activo) {
                    audio.play();
                    panel.classList.add('alarm-active');
                    btnD.classList.remove('hidden');
                    
                    Swal.fire({
                        title: data.tipo,
                        text: 'Se ha detectado actividad en la aplicaci√≥n',
                        icon: 'warning',
                        confirmButtonText: 'Entendido'
                    });
                }
            });
        }

        function detenerAlarma() {
            const audio = document.getElementById('sonidoAlarma');
            audio.pause();
            audio.currentTime = 0;
            document.getElementById('monitorPanel').classList.remove('alarm-active');
            document.getElementById('btnDetener').classList.add('hidden');
            
            // Apagar la alarma en la base de datos para todos
            db.ref('alarma').update({ activo: false });
        }

        render();
    </script>
</body>
</html>
